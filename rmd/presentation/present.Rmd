---
title: "Reading Between the Wines..."
subtitle: "Some subtitle"
author: "Garrett Hawes | Ricky Lobel | Bart "
institute: "Chapman University"
date: "2019/10/20 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      highlightStyle: solarized-dark
      highlightLines: true
      countIncrementalSlides: false
---
<!-- background-image: url(https://camo.githubusercontent.com/06e0a35a7e3014fe8c7f009d2f6bfacf14cefa93/687474703a2f2f6761727265747468617765732e636f6d2f722f636f7665722e6a706567) -->

```{r xaringan-themer, include = FALSE}
library(xaringanthemer)
xaringanthemer::solarized_dark(code_font_url = "https://cdn.rawgit.com/tonsky/FiraCode/1.204/distr/fira_code.css")
# solarized_dark(
#   base_color = "#1c5253",
#   header_font_google = google_font("Josefin Sans"),
#   text_font_google   = google_font("Montserrat", "300", "300i"),
#   code_font_google   = google_font("Droid Mono")
# )
```


```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = TRUE)
#knitr::opts_chunk$set(cache = TRUE)
knitr::opts_chunk$set(warning = FALSE)
library("conflicted")
library("here")
library("arsenal")
library("tidyverse")
library("knitr")
library("kableExtra")
library("ggExtra")
library("ggthemes")
library("GGally")
library("ggmap")
library("stringr")
library("stringi")
library("PerformanceAnalytics")
library('sentimentr')
library("tm")
library("SnowballC")
library("RColorBrewer")
library("wordcloud")
conflict_prefer("mutate", "dplyr")
conflict_prefer("summarize", "dplyr")
```

???

Image credit: Artwork by Garrett Hawes, base wine bottle from adobe stock

---
class: inverse, center, middle

# Intro

---
# Load Data 
```{r warning=FALSE}
load(here::here("data","output","clean_wine.RData"))

x<-213
```
---
# Plots 
---
# Maps 

```{r map, message=FALSE}
world_map <- map_data("world")
world_map <-
  world_map %>% dplyr::mutate(region = ifelse(region == "USA", "US", region))
world_map <- world_map %>% dplyr::mutate(country = region)

wine_map_DF <-
  wine_data_clean  %>% dplyr::mutate(country = as.character(country)) %>%
  dplyr::filter (country != "England" &
            country != "US-France" &
            country != "")

# Generate Summary
wmap <-
  wine_data_clean %>%
  dplyr::group_by(country) %>%
  dplyr::summarize(
    point_min = min(points, na.rm = TRUE),
    point_avg = mean(points, na.rm = TRUE),
    point_max = max(points, na.rm = TRUE),
    price_min = min(price, na.rm = TRUE),
    price_avg = mean(price, na.rm = TRUE),
    price_max = max(price, na.rm = TRUE)
  ) %>%
  dplyr::select(
    c(
      "country",
      "point_min",
      "point_avg",
      "point_max",
      "price_min",
      "price_avg",
      "price_max"
    )
  )
# Create data frame with bounderies and values
wine_country_map <- right_join(wmap, world_map, by = "country")

#scale_fill_viridis_c(option = "C", limits = c(80, 100))

.map_from_attribute <- function(att, title) {
  return(
    ggplot(wine_country_map, aes_string(map_id = "country", fill = att)) +
      geom_map(map = wine_country_map,  color = "white") +
      expand_limits(x = wine_country_map$long, y = wine_country_map$lat) +
      scale_fill_viridis_c(option = "C") + theme_map() + ggtitle(title) + 
      theme(plot.title = element_text(hjust = 0.5, size=20)) +
      theme(legend.title = element_blank()) 
  )
}
```
---
# Points - Min
```{r}
.map_from_attribute("point_min", "Minimum Points")
```
---
# Points - Average
```{r}
.map_from_attribute("point_avg", "Average Points")
```
---
# Points - Max
```{r}
.map_from_attribute("point_max", "Maximum Points") 
```
---
# Price - Min
```{r}
.map_from_attribute("price_min", "Minimum Price") 
```
---
# Price - Average
```{r}
.map_from_attribute("price_avg", "Average Price") 
```
---
# Price - Max
```{r}
.map_from_attribute("price_max", "Maximum Price") 
```
# Price v Points

```{r plot2, message=FALSE}
p <- ggplot(wine_data_clean, aes(points, price, color = point_cat)) + 
      geom_point() + 
      theme_clean() + 
      labs(color = "Rating Category", title = "Price vs Points") +
      theme(plot.title = element_text(hjust = 0.5)) 
p1 <- ggMarginal(p, type="histogram", fill="slateblue") 
p1 
```
---
# Price v Points (y log 10 scale)

```{r plot3, echo=FALSE, message=FALSE}
p <- ggplot(wine_data_clean, 
            aes(points, price, color = point_cat)) + 
      geom_point() + 
      theme_clean() + 
      scale_y_log10() + 
      labs(color = "Rating Category", 
           title = "Price vs Score", 
           caption="Price is scaled to log 10", 
           x = "Points", 
           y="Price") +
      theme(plot.title = element_text(hjust = 0.5)) 
p1 <- ggMarginal(p, type="histogram", fill="slateblue") 
p1 
```
---
# Box Plot
```{r plot4, fig.height=8, fig.width=10, message=FALSE}
wine_data_clean %>% 
  ggplot( aes(x = reorder(color_lump, points), 
              y = points, 
              fill = color_lump)) + 
  geom_boxplot() + 
  xlab("Color") +
  labs(x="Color", 
       y="Points", 
       title="Wine Score by color", 
       caption="Faceted by Gender") + 
  theme_clean() + 
  theme(legend.position = "none", 
        plot.title = element_text(hjust = 0.5)) + 
  facet_wrap(~ country_lump)
```
---
```{r}
ggplot(data = wine_data_clean) +
  geom_hex(mapping = aes(x = points, y = price))
```
---
# Price v Score faceted by Gender
```{r plot5, message=FALSE}
ggplot(wine_data_clean, 
       aes(points, price, color = point_cat)) + 
  geom_point() + 
  scale_y_log10()+
  theme_clean() + 
  labs(color = "Rating Category", 
       title = "Price v Score by Taster Gender", 
       x="Score", 
       y="Price", 
       caption="Price is scaled to log 10" ) + 
  theme(plot.title = element_text(hjust = 0.5)) + 
  facet_wrap(~ taster_gender)
```
---
# Price v Points by Country
```{r plot6, fig.height=10, fig.width=10, message=FALSE}
ggplot(wine_data_clean, 
       aes(y=price, 
           x=points, 
           color = point_cat)) + 
  geom_point(alpha=1/2) + 
  geom_smooth() +
  scale_y_log10()+
  theme_clean()+
  theme(plot.title = element_text(hjust = 0.5))+
  labs(color="Rating Category", 
       title = "Score vs log of Price") + 
  facet_wrap(~ country_lump)
```
---
# Price by Country
```{r plot7, fig.height=6, fig.width=8, message=FALSE, warning=FALSE, paged.print=TRUE}
ggplot(wine_data_clean, 
       aes(y = price, 
           x = country_lump, 
           color = point_cat)) +
  theme_clean()+
  theme(plot.title = element_text(hjust = 0.5))+
  coord_flip()+
  geom_jitter(alpha=1/2) + 
  labs(color="Rating Category", 
       title="Price and Country Colored by Rating Category", 
       x="Country", 
       y="Price")
```
---
# Country v Price (log10 scale)

```{r plot8, fig.height=8, fig.width=8, message=FALSE, warning=FALSE, paged.print=TRUE}
ggplot(wine_data_clean, 
       aes(x = country_lump, 
           y = price, 
           color = point_cat)) + 
  scale_y_log10() +
  geom_jitter(alpha=1/2) + 
  coord_flip() +
  labs(color = "Rating Category", 
       title="Price by Country", 
       caption="Price is scaled to log 10", 
       x = "Country", 
       y="Price") +
    theme_clean()  +
  theme(plot.title = element_text(hjust = 0.5))
```
---
# Taster Tweets v log(Price)
```{r plot9, fig.height=5, fig.width=8, message=FALSE, warning=FALSE, paged.print=TRUE}
  ggplot(wine_data_clean, 
         aes(y = price, 
             x = taster_n_tweets, 
             color = point_cat)) +
  theme_clean()+
  theme(plot.title = element_text(hjust = 0.5))+
  scale_x_log10()+
  scale_y_log10()+
  geom_jitter(alpha=1/2) + 
  labs(color="Rating Category", 
       title="Price v Number of Tweets", 
       x="Number of Tweets from Taster", 
       y="Price", 
       caption="Price and Teets Scaled to log 10")
```
---
# Session info

```{r}
sessionInfo()
```
---

